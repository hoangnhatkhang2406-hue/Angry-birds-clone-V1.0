<!DOCTYPE html>
<html>
<head>
    <title>Angry Birds Clone V1.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #87CEEB; font-family: sans-serif; }
        #ui { position: absolute; top: 10px; left: 10px; color: white; text-shadow: 1px 1px 2px black; pointer-events: none; }
    </style>
</head>
<body>
    <div id="ui">
        <h2>Angry Birds Clone V1.0</h2>
        <p>Kéo con chim đỏ và thả để bắn!</p>
    </div>

<script>
    const { Engine, Render, Runner, Bodies, Composite, Constraint, MouseConstraint, Mouse, Events } = Matter;

    const engine = Engine.create();
    const world = engine.world;
    const render = Render.create({
        element: document.body,
        engine: engine,
        options: {
            width: window.innerWidth,
            height: window.innerHeight,
            wireframes: false, // Tắt khung xương để hiện màu sắc
            background: 'transparent'
        }
    });

    // 1. Tạo Sàn
    const ground = Bodies.rectangle(window.innerWidth/2, window.innerHeight - 20, window.innerWidth, 60, { 
        isStatic: true, 
        render: { fillStyle: '#2ecc71' } 
    });

    // 2. Tạo Chim (Hình tròn đỏ)
    let bird = Bodies.circle(200, window.innerHeight - 150, 20, { 
        density: 0.004, 
        render: { fillStyle: '#e74c3c' } 
    });
    
    // 3. Tạo Ná Cao Su (SlingShot) - Đã chỉnh sửa để dây đẹp hơn
    let sling = Constraint.create({ 
        pointA: { x: 200, y: window.innerHeight - 150 }, 
        bodyB: bird, 
        stiffness: 0.05, 
        length: 1,
        render: {
            visible: true,      // Hiện dây
            lineWidth: 5,       // Dây dày hơn
            strokeStyle: '#42240c' // Màu nâu của dây thun
        }
    });

    // 4. Tạo mục tiêu (Xếp chồng các khối gỗ)
    const boxes = [];
    for(let i=0; i<5; i++) {
        boxes.push(Bodies.rectangle(window.innerWidth - 250, window.innerHeight - 100 - (i*55), 50, 50, { render: { fillStyle: '#f39c12' } }));
    }

    // 5. Điều khiển bằng chuột
    const mouse = Mouse.create(render.canvas);
    const mouseConstraint = MouseConstraint.create(engine, { mouse: mouse });

    Composite.add(world, [ground, bird, sling, ...boxes, mouseConstraint]);
    Render.run(render);
    Runner.run(Runner.create(), engine);

    // LOGIC BẮN VÀ HỒI SINH
    let isFired = false;

    Events.on(mouseConstraint, 'enddrag', (e) => {
        if(e.body === bird) isFired = true;
    });

    Events.on(engine, 'afterUpdate', () => {
        // Nếu chim đã bay đi xa (cắt dây)
        if (isFired && bird.position.x > 220) {
            sling.bodyB = null; // Cắt dây
            isFired = false;
            
            // Sau 3 giây, tạo con chim mới tại ná
            setTimeout(() => {
                if (sling.bodyB === null) {
                    bird = Bodies.circle(200, window.innerHeight - 150, 20, { density: 0.004, render: { fillStyle: '#e74c3c' } });
                    Composite.add(world, bird);
                    sling.bodyB = bird;
                }
            }, 3000);
        }
    });
</script>
</body>
</html>
